# Tome v0.2.0 - Navigation & Editing Enhancements

**Release Date:** December 9, 2025

This release introduces major user experience improvements with iOS-style navigation, book editing capabilities, test coverage tracking with CodeCov, and numerous bug fixes and performance improvements.

## ‚ú® What's New

### üì± iOS-Style Bottom Navigation (#76)

Transform Tome into a native-feeling iOS progressive web app with optional bottom navigation!

**Features:**
- **iOS-optimized design**: Perfect for "Add to Home Screen" on iPhone/iPad
- **Four navigation tabs**:
  - Dashboard - Quick overview of your reading activity
  - Library - Browse your book collection
  - Stats - View reading analytics
  - More - Settings and logout in a slide-up bottom sheet
- **LocalStorage persistence**: Your navigation preference is remembered
- **Settings toggle**: Switch between top and bottom navigation anytime
- **Safe area support**: Respects iOS notches and home indicators
- **Smooth animations**: Native-feeling slide-up transitions for bottom sheet

**New Components:**
- `BottomNavigation.tsx` - Main navigation bar
- `BottomSheet.tsx` - Modal sheet for "More" menu
- `NavigationSettings.tsx` - Settings UI for navigation style
- `useBottomNavigation.ts` - Custom hook for state management

**Usage:**
1. Visit Settings page
2. Toggle "Use Bottom Navigation"
3. Enjoy iOS-native navigation experience!

### ‚úèÔ∏è Page Count Editing (#74)

Update book page counts with automatic recalculation of reading progress!

**Features:**
- **Edit total pages**: Click "Edit" next to page count on book detail page
- **Smart recalculation**: Automatically updates progress percentages for all active session logs
- **Historical preservation**: Completed sessions remain unchanged for accuracy
- **Validation**: Ensures positive integers only
- **Error handling**: User-friendly toast notifications
- **Full test coverage**: 860+ tests for modal component and service methods

**Technical Details:**
- New `PageCountEditModal` component with form validation
- New PATCH endpoint: `/api/books/[id]` for updating `totalPages`
- New service method: `updateTotalPages()` with session recalculation logic
- New repository methods for bulk progress updates
- Percentage calculation fix: Proper integer division instead of floating point

**Architecture:**
- See [ADR-008](../ADRs/ADR-008-PAGE-COUNT-UPDATE-STRATEGY.md) for detailed design decisions

### üîç Test Coverage & Code Quality

**CodeCov Integration** (#95)
- Automated test coverage reporting on all CI/CD workflows
- Coverage uploads to CodeCov on PRs, nightly builds, and releases
- Coverage badge in README for visibility
- Configuration file (`codecov.yml`) with:
  - Project coverage tracking with 1% threshold
  - Patch coverage for new code changes
  - Ignore patterns for test files and infrastructure code
- New test script: `bun test:coverage` for local coverage reports

**Benefits:**
- Real-time coverage feedback on pull requests
- Historical coverage trend tracking
- Line-by-line coverage visualization
- Automatic PR comments with coverage diffs

### üöÄ Development Infrastructure

**Nightly Builds** (#59, #60)
- New workflow: `.github/workflows/nightly.yml` for develop branch
- Automatic Docker image publishing to GHCR
- Image tags:
  - `nightly` - Latest develop build
  - `nightly-YYYY-MM-DD-<sha>` - Timestamped builds for tracking
- OCI metadata labels for better image documentation

**Usage:**
```bash
# Pull latest nightly build
docker pull ghcr.io/masonfox/tome:nightly

# Pull specific nightly build
docker pull ghcr.io/masonfox/tome:nightly-2025-12-08-abc1234
```

## üêõ Bug Fixes

### Streak Graph Fixes (#68, #65)
- **Fixed incorrect dates**: Streak graph no longer shows future dates
- **Timezone handling**: Chart now uses `getUTCMonth()` and `getUTCDate()` to prevent timezone conversion issues
- **Analytics API**: Calculate "today" based on user's timezone instead of UTC
- **Date range calculation**: Improved timezone handling in analytics route

### UI/UX Improvements

**Library Search Enhancement** (#93)
- Replaced auto-debounced search with explicit search button
- Clearer user interaction - press Enter or click Search to filter
- Better performance - no unnecessary re-renders during typing
- Improved UX with visual search button feedback

**Bottom Sheet Active State Fix** (#90)
- Fixed Logout button incorrectly showing active state when bottom sheet opens
- Improved visual consistency in navigation

**Light Mode Contrast** (#73)
- Goal line now visible in light mode on streak chart
- Updated color from amber-500 to amber-600 for better contrast
- Increased stroke opacity: 0.5 ‚Üí 0.9
- Increased label opacity: 0.7 ‚Üí 1.0

**Backup Management** (#72)
- Automatic cleanup now removes empty date folders
- Keeps backup directory tidy after old files are deleted

**Calibre Sync Button**
- Rounded corners for visual consistency with other UI elements

### Performance Improvements

**Bottom Navigation Optimization**
- Memoized navigation items to reduce unnecessary re-renders
- Improved performance when switching between tabs
- Reduced React reconciliation overhead

**EventEmitter Memory Leak Fix** (#88)
- Prevented EventEmitter memory leak warnings in production
- Reduced log noise for cleaner monitoring
- Better resource management for long-running processes

### Developer Experience

**Logger Optimization** (#75)
- Removed `pid` and `hostname` from logger output for cleaner logs
- Improved readability for development and production environments

**Workflow Efficiency** (#79, #81)
- Removed redundant build steps from PR, publish, and nightly workflows
- Docker build already compiles the app, no need for separate build step
- Faster CI/CD pipeline execution

**Bottom Navigation Polish**
- Adjusted height for better usability
- Improved spacing and touch targets
- Removed refresh action for cleaner interface

## üìä Testing

This release includes extensive test coverage with new CodeCov integration:

**New Tests:**
- `PageCountEditModal.test.tsx` - 860 test cases for modal component
- `books-patch.test.ts` - 432 test cases for PATCH API endpoint
- `progress.repository.test.ts` - 360 test cases for progress updates
- `book.service.test.ts` - 559 additional test cases for service methods
- `read-filter-lifecycle.test.ts` - E2E integration tests for page count + status change workflow

**Test Infrastructure:**
- CodeCov integration for automated coverage tracking
- Coverage reporting on all CI workflows (PR, nightly, publish)
- Local coverage script: `bun test:coverage`
- Coverage configuration in `bunfig.toml` and `codecov.yml`

**Test Statistics:**
- Total tests: 1,400+ passing tests
- New test files: 5
- Updated test files: 3
- Coverage tracking: Enabled with automated reporting

## üõ†Ô∏è Technical Changes

### API Updates

**New Endpoints:**
- `PATCH /api/books/[id]` - Update book properties (currently supports `totalPages`)

**Enhanced Endpoints:**
- `POST /api/books/[id]/status` - Now includes rating sync check for status changes

### Database & Repositories

**New Repository Methods:**
- `progress.repository.updatePercentagesByBookId()` - Bulk update progress percentages
- `session.repository.getActiveSessionIds()` - Get active sessions for a book

**Service Layer:**
- `book.service.updateTotalPages()` - Update pages with automatic recalculation
- Enhanced `updateStatus()` - Better rating consistency checks

### Components & Hooks

**New Components:**
- `BottomNavigation` - iOS-style bottom navigation bar
- `BottomSheet` - Slide-up modal sheet
- `NavigationSettings` - Navigation preference toggle
- `PageCountEditModal` - Page count editing UI

**New Hooks:**
- `useBottomNavigation` - Manage navigation preference with localStorage

**Updated Components:**
- `LayoutWrapper` - Conditional navigation rendering
- `Navigation` - Use centralized navigation config
- `StreakChart` - Improved date handling and contrast
- `BookHeader` - Add page count edit button

### Configuration & Infrastructure

**New Files:**
- `lib/navigation-config.ts` - Centralized navigation links (DRY principle)
- `.github/workflows/nightly.yml` - Nightly build workflow
- `docs/ADRs/ADR-008-PAGE-COUNT-UPDATE-STRATEGY.md` - Architecture decision record
- `codecov.yml` - CodeCov configuration with thresholds and ignore patterns

**Updated Files:**
- `app/globals.css` - Added animations and iOS safe-area support
- `docker-entrypoint.sh` - Empty folder cleanup
- `bunfig.toml` - Coverage reporting configuration
- `package.json` - Added test:coverage script
- Various workflow files - Removed redundant steps and added coverage uploads

## üìñ Documentation

**New Documentation:**
- [ADR-008: Page Count Update Strategy](../ADRs/ADR-008-PAGE-COUNT-UPDATE-STRATEGY.md)
  - Detailed analysis of update strategies
  - Decision rationale for percentage recalculation
  - Implementation guidelines

**Updated Documentation:**
- `AI_INSTRUCTIONS.md` - Added develop branch gitflow documentation

## üîÑ Migration Notes

**From v0.1.0 to v0.2.0:**

No database migrations required! All changes are backwards-compatible.

**New Optional Features:**
1. **Bottom Navigation**: Disabled by default, enable in Settings ‚Üí Navigation Style
2. **Page Count Editing**: Access via "Edit" button on book detail page next to page count

**Docker Images:**
- Production: `ghcr.io/masonfox/tome:0.2.0`, `ghcr.io/masonfox/tome:latest`
- Development: `ghcr.io/masonfox/tome:nightly`

## üéØ Breaking Changes

None! This release maintains full backwards compatibility with v0.1.0.

## üì¶ Installation

### Docker (Recommended)

**Stable Release:**
```bash
docker pull ghcr.io/masonfox/tome:0.2.0

docker run -d \
  --name tome \
  -p 3000:3000 \
  -v tome-data:/app/data \
  -v /path/to/calibre/library:/calibre \
  -e CALIBRE_DB_PATH=/calibre/metadata.db \
  ghcr.io/masonfox/tome:0.2.0
```

**Nightly Build:**
```bash
docker pull ghcr.io/masonfox/tome:nightly

docker run -d \
  --name tome \
  -p 3000:3000 \
  -v tome-data:/app/data \
  -v /path/to/calibre/library:/calibre \
  -e CALIBRE_DB_PATH=/calibre/metadata.db \
  ghcr.io/masonfox/tome:nightly
```

### Upgrading from v0.1.0

**Docker:**
```bash
# Stop existing container
docker stop tome

# Pull new version
docker pull ghcr.io/masonfox/tome:0.2.0

# Start with new image (your data is preserved in the volume)
docker run -d \
  --name tome \
  -p 3000:3000 \
  -v tome-data:/app/data \
  -v /path/to/calibre/library:/calibre \
  -e CALIBRE_DB_PATH=/calibre/metadata.db \
  ghcr.io/masonfox/tome:0.2.0
```

**Local Development:**
```bash
# Pull latest code
git pull origin main

# Install dependencies
bun install

# No migrations needed!

# Start server
bun run dev
```

## üîÆ What's Next

Planned for future releases:

**v0.3.0 Candidates:**
- Data export/import functionality ([#14](https://github.com/masonfox/tome/issues/14))
- Goodreads/StoryGraph import ([#11](https://github.com/masonfox/tome/issues/11))
- Advanced search operators ([#3](https://github.com/masonfox/tome/issues/3))

**Community Requests:**
- Additional book metadata editing
- Reading goals and challenges
- Book series tracking
- Enhanced statistics visualizations

See [open issues](https://github.com/masonfox/tome/issues) for the full roadmap.

## üôè Contributors

This release includes contributions from:
- [@masonfox](https://github.com/masonfox) - Core features and bug fixes
- [@Copilot](https://github.com/apps/copilot) - Bottom navigation, backup fixes, UI improvements
- [@claude](https://github.com/claude) - Page count editing feature

Special thanks to the community for bug reports and feature suggestions!

## üìù Full Changelog

**Features:**
- Add iOS-style bottom navigation with localStorage persistence (#76)
- Add page count editing functionality (#74)
- Add test coverage reporting with CodeCov integration (#95)
- Add nightly build workflow for develop branch (#59, #60)

**Bug Fixes:**
- Fix streak graph showing incorrect dates and future data (#68, #65)
- Fix bottomsheet Logout button showing active state on open (#90)
- Fix EventEmitter memory leak warnings and reduce log noise (#88)
- Fix goal line visibility in light mode on streak chart (#73)
- Fix backup cleanup to remove empty date folders (#72)
- Fix timezone handling in streak analytics date range calculation

**Improvements:**
- Replace auto-debounced library search with explicit search button (#93)
- Refactor page count update transaction logic to repository layer (#92)
- Performance: Memoize BottomNavigation items to reduce re-render overhead
- Round Calibre sync button for visual consistency
- Remove pid and hostname from logger output (#75)
- Adjust bottom navigation spacing and remove refresh (#81)
- Adjust bottom nav height for better usability (#79)
- Remove redundant build steps from CI workflows

**Documentation:**
- Add ADR-008: Page Count Update Strategy
- Update AI instructions with develop branch gitflow
- Add CodeCov badge to README

**Tests:**
- Add E2E integration tests for page count + status change workflow
- Add comprehensive tests for page count editing (860+ tests)
- Add API and repository tests for PATCH endpoint (432+ tests)
- Add progress repository tests (360+ tests)
- Add book service tests (559+ tests)
- Configure automated coverage tracking with CodeCov

## üîó Links

- **Repository**: https://github.com/masonfox/tome
- **Docker Images**: 
  - Stable: `ghcr.io/masonfox/tome:0.2.0`
  - Latest: `ghcr.io/masonfox/tome:latest`
  - Nightly: `ghcr.io/masonfox/tome:nightly`
- **Issues**: https://github.com/masonfox/tome/issues
- **Pull Request**: https://github.com/masonfox/tome/pull/84

---

**Ready to upgrade?** Pull the latest Docker image or update your local installation. Your data will be preserved!

Thank you for using Tome! We'd love to hear your feedback on the new features.
